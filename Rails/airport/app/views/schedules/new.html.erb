<%= form_with model: @schedule do |f| %>
  <div class="mb-3">
    <h3>
      <%= f.label :flightschedule, "Schedule New Aircraft Flight Here " %>
    </h3>
  </div>
  <div class="mb-3" id="from">
    <%= f.label :from, "From : " %>
    <% cities = City.pluck(:name) %>
    <% cities.append("SELECT") %>
      <%= f.select :from, cities , :selected => "SELECT" %>
  </div>
  <div class="mb-3" id="dest" style="display:none;">
    <%= f.label :destination %>
    <%= f.select :destination, ["Select"] %>
  </div>
  <div class="mb-3" id="flightSchedule" style="display:none;">
    <h5><%= f.label :schedule, "Available Flight Schedule for this route =>" %></h5>
    <table id ="flight-schedule-table" class="table table-striped">
      <tr><td>data here</td></tr>
    </table>
  </div>
  <div class="mb-3" id="airship" style="display:none;">
    <h5><%= f.label :aircraft, "Available Aircraft for this flights =>" %></h5>
    <%= f.select :aircraft, ["Select"] %>
  </div>
  <div class="mb-3" id="pilots" style="display:none;">
    <h5><%= f.label :pilot, "Available pilot to fly this aircraft" %></h5>
    <%= f.select :pilot, ["Select"] %>
  </div>
  <div class="mb-3" id="submitbtn" style="display:none;">
    <%= f.submit "Schedule this Flight " %>
  </div>

  <% end %>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
      let schedule_from = document.getElementById('schedule_from');
      let dest = document.getElementById('dest');
      let len = schedule_from.length;

      //schedule_from.addEventListener("change", show());
      $('#schedule_from').change(function(){
        dest.style.display = "block";
        schedule_destination = document.getElementById('schedule_destination');

        schedule_destination.innerHTML = "";
        let i = 0;
        let city_from = schedule_from.options[schedule_from.selectedIndex].text;
        while(i < len ){
          let city = schedule_from.options.item(i).text;
          if (city_from != city ) {
            let option = document.createElement("option");
            option.value = option.text = city ;
            schedule_destination.appendChild(option);
          }
          i++;
        }
        schedule_destination.value = "SELECT";
      });


      let count = 0;
      schedule_destination = document.getElementById('schedule_destination');
      flightSchedule = document.getElementById('flightSchedule');

  

      $('#schedule_destination').change(function(){
        flightSchedule.style.display = "block";
        let city_from = schedule_from.options[schedule_from.selectedIndex].text;
        let city_destination = schedule_destination.options[schedule_from.selectedIndex].text;
        let data = '<tr ><td>Departs At: </td><td>Arrives At: </td><td>Distance: </td></tr>';
        
        <% Flight.all.each do |flight| %>

        if (city_from == '<%= flight.from %>' && city_destination == '<%= flight.destination %>') {
          data += "<tr class='clickable-row' id = <%= flight.id %> ><td><%= flight.departs.strftime('%a\'%d,%b,%y %I:%M %p') if flight.departs %></td><td><%= flight.arrives.strftime('%a\'%d,%b,%y %I:%M %p') if flight.arrives %></td><td><%= flight.distance %></td></tr>";
        }
        <% end %>
        $('#flight-schedule-table').html(data);
        $('#flight-schedule-table tr').click(function(){
          //alert( "Handler for .dblclick() called." );
          //document.getElementById('airship').style.display = "block";
          $(this).css('background-color','yellow').siblings().css('background-color','white');
          $('#airship').show();
          schedule_aircraft = document.getElementById('schedule_aircraft');

          schedule_aircraft.innerHTML = "";
          <%Aircraft.all.each do |aircraft|%>
             option = document.createElement("option");
             option.value = '<%= aircraft.id %>';
             option.text = '<%= aircraft.name %>';
             schedule_aircraft.appendChild(option);
          <% end %>
          option.value = option.text = 'SELECT';
          schedule_aircraft.appendChild(option);
          schedule_aircraft.value = "SELECT";
      });
        
      });

      $('#schedule_aircraft').change(function(){
        console.log("Aircraft seleected");
        $('#pilots').show();
        $('#submitbtn').show();
        schedule_pilot = document.getElementById('schedule_pilot');

        schedule_pilot.innerHTML = "";
          <%Employee.where(id: Certified.pluck("employee_id").uniq()).each do |employee|%>
             option = document.createElement("option");
             option.value = '<%= employee.id %>';
             option.text = '<%= employee.name %>';
             schedule_pilot.appendChild(option);
          <% end %>
          option.value = option.text = 'SELECT';
          schedule_pilot.appendChild(option);
          schedule_pilot.value = "SELECT";
      });
    </script>
